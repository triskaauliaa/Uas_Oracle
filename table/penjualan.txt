CREATE TABLE  "T_PENJUALAN" 
   (	"KD_TRANSAKSI" NUMBER(5,0), 
	"KD_CUSTOMER" NUMBER(5,0), 
	"KD_BARANG" NUMBER(5,0), 
	"TGL" DATE, 
	"JML" NUMBER(7,0), 
	"HARGA" FLOAT(2), 
	 CONSTRAINT "TB_PENJUALAN_PK" PRIMARY KEY ("KD_TRANSAKSI") ENABLE
   )
/
ALTER TABLE  "T_PENJUALAN" ADD CONSTRAINT "TB_PENJUALAN_FK" FOREIGN KEY ("KD_CUSTOMER")
	  REFERENCES  "T_CUSTOMER" ("KD_CUSTOMER") ENABLE
/
ALTER TABLE  "T_PENJUALAN" ADD CONSTRAINT "TB_PENJUALAN_FK2" FOREIGN KEY ("KD_BARANG")
	  REFERENCES  "T_BARANG" ("KD_BARANG") ENABLE
/


CREATE OR REPLACE TRIGGER  "BI_TB_PENJUALAN" 
  before insert on "T_PENJUALAN"               
  for each row  
begin   
  if :NEW."KD_PENJUALAN" is null then 
    select "TB_PENJUALAN_SEQ".nextval into :NEW."KD_PENJUALAN" from sys.dual; 
  end if; 
end; 

/
ALTER TRIGGER  "BI_TB_PENJUALAN" ENABLE
/


CREATE OR REPLACE TRIGGER  "T_PENJUALAN_UPDATE_JML_TBARANG" 
BEFORE
insert or update or delete on "T_PENJUALAN"
for each row
 WHEN (NEW.ID_BARANG > 0) BEGIN   
   UPDATE t_barang
   SET jml = jml - :new.t_penjualan.jml
   WHERE id_barang = new.id_barang;
END;
/
ALTER TRIGGER  "T_PENJUALAN_UPDATE_JML_TBARANG" ENABLE
/
